<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Attendance</title>
<link rel="manifest" href="manifest.json">
<style>
 body{font-family:Arial;padding:20px}
 button{padding:10px 14px;background:#0b79d0;color:#fff;border:0;border-radius:6px}
</style>
</head>
<body>
<h2>Driver Attendance</h2>
<p><b>Driver:</b> <span id="driverDisplay">—</span></p>

<div id="nameArea">
  <input id="driverName" placeholder="Enter your name" style="padding:10px;width:100%;margin-top:10px">
  <button id="saveName" style="margin-top:10px">Save</button>
</div>

<div id="msg" style="margin-top:20px;color:green"></div>
<div id="err" style="margin-top:20px;color:red"></div>

<script>
// CONFIG
const WEB_APP_URL="https://script.google.com/macros/s/AKfycbzyrnoZnI7XsqAHvo8JYoF1Sl70MrDNEPNTXjaFTJ0hnAcizQF5T9C8DbDiKQiM4ooB/exec";
const SECRET="rT7v9Kp3LmQ2Zx8VbH1sF4NcY6Ua0WqP";

// driver name handling
const key="driverName";
const dDisp=document.getElementById("driverDisplay");
const nameArea=document.getElementById("nameArea");
const msg=document.getElementById("msg");
const err=document.getElementById("err");

function setDriverUI(n){
  if(n){ dDisp.textContent=n; nameArea.style.display="none"; }
  else{ dDisp.textContent="—"; nameArea.style.display="block"; }
}
setDriverUI(localStorage.getItem(key));

document.getElementById("saveName").onclick=()=>{
  const v=document.getElementById("driverName").value.trim();
  if(!v){alert("Enter name");return;}
  localStorage.setItem(key,v);
  setDriverUI(v);
};

// extract ?car=
const params=new URLSearchParams(location.search);
if(params.has("car")){
  const car=params.get("car");
  const driver=localStorage.getItem(key);

  if(driver){
    send(car,driver);
  }else{
    document.getElementById("saveName").onclick=()=>{
      const v=document.getElementById("driverName").value.trim();
      if(!v){alert("Enter name");return;}
      localStorage.setItem(key,v);
      setDriverUI(v);
      send(car,v);
    }
  }
}

async function send(car,driver){
  msg.textContent="Sending...";
  err.textContent="";
  try{
    const url=WEB_APP_URL+"?car="+encodeURIComponent(car)+"&driver="+encodeURIComponent(driver)+"&tok="+SECRET;
    const r=await fetch(url);
    const t=await r.text();
    if(r.ok){ msg.textContent="Recorded at "+new Date().toLocaleString(); }
    else{ err.textContent="Server error: "+t; }
  }catch(e){ err.textContent="Network error: "+e; }
}
</script>
</body>
</html>
